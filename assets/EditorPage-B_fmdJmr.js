const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BU-NPzoO.js","assets/index-Bn_ZGk2L.css"])))=>i.map(i=>d[i]);
import{u as Q,r as i,j as e,L as pe,F as J,E as he,U as fe,P as ge,_ as be}from"./index-BU-NPzoO.js";import{B as je,C as ve,S as ye,E as we,G as Ce,A as Ne}from"./AdvancedPanel-BN0HpQd_.js";async function ke(l,y){return new Promise(s=>{setTimeout(()=>{s({...l,status:"completed",preview:l.preview})},2e3)})}function Se(l){if(!l)return!1;const y=l.toLowerCase();return[".arw",".cr2",".cr3",".nef",".dng",".raw"].some(r=>y.includes(r))}const L=({channel:l="rgb",onCurveChange:y})=>{const{curves:s,updateCurve:r}=Q(),M=i.useRef(null),[w,j]=i.useState(!1),[f,g]=i.useState(null),[P,C]=i.useState(null),[E,U]=i.useState(10),x=s[l]||[];i.useEffect(()=>{x.length===0&&r(l,[[0,0],[1,1]])},[l,x.length,r]);const N=i.useCallback(()=>{const m=M.current;if(!m)return;const t=m.getContext("2d"),d=m.width,o=m.height;t.clearRect(0,0,d,o),t.strokeStyle="#333",t.lineWidth=1;for(let a=0;a<=d;a+=E)t.beginPath(),t.moveTo(a,0),t.lineTo(a,o),t.stroke();for(let a=0;a<=o;a+=E)t.beginPath(),t.moveTo(0,a),t.lineTo(d,a),t.stroke();if(t.strokeStyle="#555",t.lineWidth=2,t.beginPath(),t.moveTo(0,o),t.lineTo(d,0),t.stroke(),x.length>0){t.strokeStyle=l==="rgb"?"#ffffff":l==="r"?"#ff0000":l==="g"?"#00ff00":l==="b"?"#0000ff":"#ffff00",t.lineWidth=3,t.beginPath();for(let a=0;a<x.length-1;a++){const[p,u]=x[a],[b,A]=x[a+1],z=p*d,k=o-u*o,B=b*d,D=o-A*o;a===0&&t.moveTo(z,k),t.lineTo(B,D)}t.stroke(),x.forEach(([a,p],u)=>{const b=a*d,A=o-p*o,z=P&&P.index===u,k=f&&f.index===u;t.beginPath(),t.arc(b,A,z||k?8:6,0,2*Math.PI),t.fillStyle=k?"#ff9900":z?"#ffffff":"#4a9eff",t.fill(),t.strokeStyle="#000",t.lineWidth=1,t.stroke()})}},[x,l,E,P,f]);i.useEffect(()=>{N()},[N]);const R=m=>{const t=M.current,d=t.getBoundingClientRect(),o=(m.clientX-d.left)/t.width,a=1-(m.clientY-d.top)/t.height;return[Math.max(0,Math.min(1,o)),Math.max(0,Math.min(1,a))]},v=(m,t,d=.05)=>{for(let o=0;o<x.length;o++){const[a,p]=x[o];if(Math.sqrt(Math.pow(a-m,2)+Math.pow(p-t,2))<d)return{index:o,point:[a,p]}}return null},I=m=>{const[t,d]=R(m),o=v(t,d);if(o)g(o),j(!0);else{const a=[...x,[t,d]].sort((u,b)=>u[0]-b[0]);r(l,a);const p=a.findIndex(([u,b])=>u===t&&b===d);g({index:p,point:[t,d]}),j(!0)}},Y=m=>{const[t,d]=R(m);if(w&&f){const o=[...x],[a,p]=o[f.index];let u=t;f.index===0?u=0:f.index===x.length-1&&(u=1),o[f.index]=[u,d],r(l,o),g({...f,point:[u,d]})}else{const o=v(t,d,.03);C(o)}},F=()=>{j(!1)},O=m=>{const[t,d]=R(m),o=v(t,d,.03);if(o&&o.index!==0&&o.index!==x.length-1){const a=x.filter((p,u)=>u!==o.index);r(l,a),g(null)}},T=()=>{r(l,[[0,0],[1,1]]),g(null),C(null)};return e.jsxs("div",{className:"curve-editor",style:{background:"#1a1a1a",borderRadius:"8px",padding:"16px",color:"#e0e0e0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsxs("h3",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:l==="rgb"?"#ffffff":l==="r"?"#ff6666":l==="g"?"#66ff66":l==="b"?"#6666ff":"#ffff66"},children:[l.toUpperCase()," Curve"]}),e.jsx("button",{onClick:T,style:{background:"rgba(255,255,255,0.1)",border:"1px solid #4a5568",color:"#e0e0e0",borderRadius:"4px",padding:"4px 8px",cursor:"pointer",fontSize:"12px"},children:"Reset"})]}),e.jsx("div",{style:{position:"relative",marginBottom:"12px"},children:e.jsx("canvas",{ref:M,width:300,height:300,onMouseDown:I,onMouseMove:Y,onMouseUp:F,onMouseLeave:F,onDoubleClick:O,style:{width:"100%",height:"300px",background:"#2a2a2a",borderRadius:"4px",cursor:w?"grabbing":"crosshair"}})}),e.jsx("div",{style:{fontSize:"12px",color:"#a0a0a0",textAlign:"center"},children:"Click to add points • Drag to move • Double-click to remove"})]})},Pe=({isActive:l,onPanelChange:y})=>{const{curves:s,updateCurve:r}=Q();return l?e.jsxs("div",{className:"curves-panel",style:{padding:"20px",background:"#1a1a1a",borderRadius:"8px",color:"#e0e0e0"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"20px",color:"#4a9eff"},children:"Tone Curves"}),e.jsx("p",{style:{fontSize:"14px",color:"#a0a0a0",marginBottom:"20px"},children:"Adjust the tonal range of your image by modifying curve points. Drag points to create custom curves or double-click to remove points."}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px"},children:[e.jsx(L,{channel:"rgb"}),e.jsx(L,{channel:"r"}),e.jsx(L,{channel:"g"}),e.jsx(L,{channel:"b"}),e.jsx(L,{channel:"luminance"})]}),e.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"rgba(255,255,255,0.05)",borderRadius:"6px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"10px"},children:"Curve Presets"}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>{r("rgb",[[0,0],[1,1]]),r("r",[[0,0],[1,1]]),r("g",[[0,0],[1,1]]),r("b",[[0,0],[1,1]]),r("luminance",[[0,0],[1,1]])},style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"1px solid #4a5568",color:"#e0e0e0",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"Reset All"}),e.jsx("button",{onClick:()=>{r("rgb",[[0,0],[.25,.1],[.75,.9],[1,1]])},style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"1px solid #4a5568",color:"#e0e0e0",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"S-Curve (Contrast)"}),e.jsx("button",{onClick:()=>{r("rgb",[[0,0],[.25,.3],[.75,.7],[1,1]])},style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"1px solid #4a5568",color:"#e0e0e0",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"Inverse S (Soft)"}),e.jsx("button",{onClick:()=>{r("rgb",[[0,.2],[.5,.5],[1,1]])},style:{padding:"8px 16px",background:"rgba(255,255,255,0.1)",border:"1px solid #4a5568",color:"#e0e0e0",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"Shadows Boost"})]})]})]}):null};function S({title:l,children:y,defaultOpen:s=!0}){const[r,M]=i.useState(s);return e.jsxs("div",{className:"collapsible-panel",children:[e.jsxs("button",{className:"panel-header",onClick:()=>M(!r),children:[e.jsx("span",{className:"panel-title",children:l}),e.jsx("span",{className:`panel-chevron ${r?"open":""}`,children:"▼"})]}),r&&e.jsx("div",{className:"panel-content",children:y})]})}const Me=()=>{const[l,y]=i.useState({quality:50,format:"jpeg",resize:1e3,sharpening:0,noiseReduction:0}),[s,r]=i.useState(null),[M,w]=i.useState(null),[j,f]=i.useState({exposure:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,gamma:1}),[g,P]=i.useState({temperature:0,tint:0,hue:0,saturation:0}),[C,E]=i.useState({amount:0,radius:1,detail:.5,masking:0}),[U,x]=i.useState({vignette:0,grain:0,blur:0}),[N,R]=i.useState({crop:0,rotate:0,flip:"none"}),[v,I]=i.useState({hdr:1,curves:1,channelMixer:1}),[Y,F]=i.useState(null),[O,T]=i.useState(50),[m,t]=i.useState(!1),[d,o]=i.useState(1),[a,p]=i.useState({x:0,y:0}),[u,b]=i.useState(!1),[A,z]=i.useState(320),[k,B]=i.useState(!1);i.useEffect(()=>{if(s){const n=typeof s=="string"?s:s.url;F(n)}},[s,j,g,C,U,N,v]);const D=async n=>{if(r(n),n&&n.filename&&Se(n.filename))try{const c=await ke(n);w(c.preview)}catch{w(null)}else w(n.url||n.preview)},K=()=>{f({exposure:0,contrast:0,highlights:0,shadows:0,whites:0,blacks:0,gamma:1}),P({temperature:0,tint:0,hue:0,saturation:0}),E({amount:0,radius:1,detail:.5,masking:0}),x({vignette:0,grain:0,blur:0}),R({crop:0,rotate:0,flip:"none"}),I({hdr:1,curves:1,channelMixer:1}),y({quality:50,format:"jpeg",resize:1e3,sharpening:0,noiseReduction:0})},ee=()=>{console.log("Undo action triggered")},te=()=>{console.log("Redo action triggered")},ne=()=>p(n=>({...n,x:n.x-20})),se=()=>p(n=>({...n,x:n.x+20})),oe=()=>p(n=>({...n,y:n.y-20})),ae=()=>p(n=>({...n,y:n.y+20})),ie=()=>o(n=>Math.min(n+.1,3)),le=()=>o(n=>Math.max(n-.1,.1)),re=()=>{o(1),p({x:0,y:0})},ce=n=>{B(!0),document.body.classList.add("resizing"),n.preventDefault()},Z=n=>{if(!k)return;const c=window.innerWidth-n.clientX,h=250,G=Math.min(600,window.innerWidth*.6);c>=h&&c<=G&&z(c)},q=()=>{B(!1),document.body.classList.remove("resizing")};i.useEffect(()=>{if(k)return document.addEventListener("mousemove",Z),document.addEventListener("mouseup",q),()=>{document.removeEventListener("mousemove",Z),document.removeEventListener("mouseup",q)}},[k]),i.useEffect(()=>()=>{document.body.classList.remove("resizing")},[]);const de=()=>{if(!s)return;const n=typeof s=="string"?s:s.url,c=typeof s=="string"?"image_raw.jpg":s.filename||"image_raw.jpg",h=document.createElement("a");h.href=n,h.download=c,document.body.appendChild(h),h.click(),document.body.removeChild(h)},$=async()=>{if(s){t(!0);try{const n=document.createElement("canvas"),c=n.getContext("2d",{willReadFrequently:!0}),h=new Image;h.crossOrigin="anonymous";const G=typeof s=="string"?s:s.url;h.src=G,await new Promise((_,X)=>{h.onload=_,h.onerror=X}),n.width=h.width,n.height=h.height,c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.drawImage(h,0,0);const xe={...j,...g,...C,...U,...N,...v},{applyProfessionalFilters:me}=await be(async()=>{const{applyProfessionalFilters:_}=await import("./index-BU-NPzoO.js").then(X=>X.d);return{applyProfessionalFilters:_}},__vite__mapDeps([0,1]));me(c,h,xe);const H=n.toDataURL("image/jpeg",.95),W=document.createElement("a");W.href=H;let V="edited_image.jpg";(s.filename||s.name)&&(V=`${(s.filename||s.name).split(".").slice(0,-1).join(".")}_edited.jpg`),W.download=V,document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(H)}catch(n){console.error("Export error:",n),alert("Export failed. Please try again.")}finally{t(!1)}}},ue=!s||typeof s=="object"&&Object.keys(s).length===0||typeof s=="string"&&s.trim()==="";return e.jsxs("div",{className:"editor-page",children:[e.jsxs("div",{style:{background:"#222",color:"#fff",padding:"6px 12px",fontSize:"12px",marginBottom:"8px",borderRadius:"6px",maxWidth:"600px"},children:[e.jsx("b",{children:"Debug Info:"})," uploadedImage = ",JSON.stringify(s),e.jsx("button",{style:{marginLeft:"16px",padding:"2px 8px",fontSize:"12px",borderRadius:"4px",background:"#4a9eff",color:"#fff",border:"none",cursor:"pointer"},onClick:()=>{r(null),w(null)},children:"Reset Editor"})]}),e.jsxs("header",{className:"editor-header flex items-center justify-between",children:[e.jsxs("div",{className:"header-left flex items-center gap-4",children:[e.jsx(pe,{to:"/",className:"back-link",children:"← Back to Home"}),e.jsx("h1",{className:"editor-title",children:"Edit Photo"}),!s&&e.jsx(J,{onFileUpload:D,className:"header-uploader"}),s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{r(null),w(null)},className:"toolbar-btn upload-btn",title:"Upload New Image",children:"📁 Upload"}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",title:"Edit",children:"✏️ Edit"}),e.jsx("button",{className:"toolbar-btn",onClick:$,title:"Save",children:"💾 Save"}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:`toolbar-btn ${u?"active":""}`,onClick:()=>b(!u),title:"Toggle Edit Panel",children:"⚙️ Adjustments"})]})]}),e.jsx("div",{className:"header-right"})]}),e.jsx("div",{className:"editor-toolbar flex flex-row items-center gap-4",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"toolbar-section flex flex-row items-center gap-2",children:[e.jsx("button",{className:"toolbar-btn",onClick:ne,title:"Pan Left",children:"←"}),e.jsx("button",{className:"toolbar-btn",onClick:se,title:"Pan Right",children:"→"}),e.jsx("button",{className:"toolbar-btn",onClick:oe,title:"Pan Up",children:"↑"}),e.jsx("button",{className:"toolbar-btn",onClick:ae,title:"Pan Down",children:"↓"}),e.jsx("button",{className:"toolbar-btn",onClick:ie,title:"Zoom In",children:"+"}),e.jsx("button",{className:"toolbar-btn",onClick:le,title:"Zoom Out",children:"-"}),e.jsx("button",{className:"toolbar-btn",onClick:re,title:"Reset View",children:"⌂"}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("button",{className:"toolbar-btn",onClick:ee,title:"Undo",children:"Undo"}),e.jsx("button",{className:"toolbar-btn",onClick:te,title:"Redo",children:"Redo"})]}),e.jsx("div",{className:"toolbar-divider"}),e.jsx("div",{className:"toolbar-section flex flex-row items-center gap-2",children:e.jsx("button",{className:"toolbar-btn",title:"EXIF Metadata",children:"EXIF"})}),e.jsx("div",{className:"toolbar-divider"}),e.jsxs("div",{className:"toolbar-section flex flex-row items-center gap-2",children:[e.jsx("button",{onClick:K,className:"toolbar-btn",title:"Reset All",children:"🔄 Reset"}),e.jsx("button",{onClick:de,className:"toolbar-btn",title:"Download RAW",children:"📥 RAW"}),e.jsx("button",{onClick:$,className:"toolbar-btn",title:"Download JPEG",children:"📥 JPEG"})]}),e.jsx("div",{className:"toolbar-spacer"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"toolbar-section",children:e.jsx("span",{className:"toolbar-text",children:"Ready to edit your images"})}),e.jsx("div",{className:"toolbar-spacer"}),e.jsx("div",{className:"toolbar-section",children:e.jsx(J,{onFileUpload:D,className:"toolbar-uploader"})})]})}),e.jsx("div",{className:"editor-main-content",children:ue?e.jsxs("div",{className:"editor-upload-container flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(J,{onFileUpload:D,className:"header-uploader"}),e.jsxs("div",{style:{color:"#fff",marginTop:"16px",fontSize:"14px"},children:["If you do not see the upload button, click ",e.jsx("b",{children:"Reset Editor"})," above or reload the page."]})]}):e.jsxs("div",{className:"main-editor-content",children:[e.jsxs("div",{className:"image-preview-container full-width-only",children:[e.jsx("div",{className:"image-preview-tile edited-preview full-width",children:e.jsx(he,{imageSrc:s,edits:{...j,...g,...C,...U,...N,...v},showSlider:!0,sliderPosition:O,onSliderChange:T,hideControls:!0,hideFullscreen:!1})}),e.jsx("div",{className:"slider-control-container",children:e.jsx(fe,{min:0,max:100,value:O,onChange:T,label:"Before/After Comparison"})})]}),u&&e.jsxs("div",{className:"side-controls-panel overlay resizable",style:{width:`${A}px`},children:[e.jsx("div",{className:"resize-handle",onMouseDown:ce,title:"Drag to resize panel"}),e.jsx("button",{className:"panel-close",onClick:()=>b(!1),title:"Close Panel",children:"✕"}),e.jsxs("div",{className:"panel-content",children:[e.jsx("h3",{className:"panel-title",children:"Edit Controls"}),e.jsx(S,{title:"Basic Adjustments",defaultOpen:!0,children:e.jsx(je,{adjustments:j,onChange:f})}),e.jsx(S,{title:"Color Adjustments",defaultOpen:!1,children:e.jsx(ve,{colorAdjustments:g,onChange:P})}),e.jsx(S,{title:"Sharpness & Detail",defaultOpen:!1,children:e.jsx(ye,{sharpness:C,onChange:E})}),e.jsx(S,{title:"Effects & Filters",defaultOpen:!1,children:e.jsx(we,{effects:U,onChange:x})}),e.jsx(S,{title:"Geometry",defaultOpen:!1,children:e.jsx(Ce,{geometry:N,onChange:R})}),e.jsx(S,{title:"Advanced",defaultOpen:!1,children:e.jsx(Ne,{advanced:v,onChange:I})}),e.jsx(S,{title:"Tone Curves",defaultOpen:!1,children:e.jsx(Pe,{isActive:!0})}),e.jsx(S,{title:"Presets",defaultOpen:!1,children:e.jsx(ge,{onApplyPreset:n=>{f(c=>({...c,...n})),P(c=>({...c,...n})),E(c=>({...c,...n})),x(c=>({...c,...n})),R(c=>({...c,...n})),I(c=>({...c,...n}))},currentEdits:{...j,...g,...C,...U,...N,...v}})})]})]})]})})]})};export{Me as default};
